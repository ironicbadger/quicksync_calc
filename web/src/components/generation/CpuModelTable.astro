---
/**
 * CpuModelTable - Table of CPUs in a generation with benchmark data
 */

interface CpuModel {
  cpu_raw: string;
  result_count: number;
  avg_fps: number;
  fps_per_watt: number | null;
  score: number | null;
}

// Get score badge class based on score value
function getScoreClass(score: number | null): string {
  if (score === null) return '';
  if (score >= 70) return 'score-high';
  if (score >= 40) return 'score-mid';
  return 'score-low';
}

interface Props {
  cpuModels: CpuModel[];
  generationId: string;
}

const { cpuModels, generationId } = Astro.props;

// Strip Intel branding for cleaner display
function stripIntelBranding(cpu: string): string {
  return cpu
    .replace(/Intel\(R\)\s*/gi, '')
    .replace(/Core\(TM\)\s*/gi, '')
    .replace(/CPU\s*@\s*[\d.]+GHz/gi, '')
    .replace(/\s+/g, ' ')
    .trim();
}
---

<div class="cpu-model-table">
  <table>
    <thead>
      <tr>
        <th>CPU Model</th>
        <th class="numeric">Results</th>
        <th class="numeric">Avg FPS</th>
        <th class="numeric">FPS/Watt</th>
        <th class="numeric">Score</th>
      </tr>
    </thead>
    <tbody>
      {cpuModels.length === 0 ? (
        <tr>
          <td colspan="5" class="empty-state">
            No benchmark data available yet for this generation.
          </td>
        </tr>
      ) : (
        cpuModels.map((cpu, index) => (
          <tr>
            <td class="cpu-name" title={cpu.cpu_raw}>
              {index === 0 && <span class="rank-badge">Top</span>}
              {stripIntelBranding(cpu.cpu_raw)}
            </td>
            <td class="numeric">{cpu.result_count}</td>
            <td class="numeric">{cpu.avg_fps.toFixed(1)}</td>
            <td class="numeric">
              {cpu.fps_per_watt ? cpu.fps_per_watt.toFixed(2) : '—'}
            </td>
            <td class="numeric">
              {cpu.score !== null ? (
                <span class:list={['score-badge', getScoreClass(cpu.score)]}>{cpu.score}</span>
              ) : '—'}
            </td>
          </tr>
        ))
      )}
    </tbody>
  </table>
</div>

<style>
  .cpu-model-table {
    width: 100%;
    overflow-x: auto;
  }

  .cpu-model-table table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.875rem;
  }

  .cpu-model-table th {
    text-align: left;
    padding: 0.75rem 1rem;
    font-weight: 500;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
    border-bottom: 2px solid var(--color-border);
  }

  .cpu-model-table th.numeric {
    text-align: right;
  }

  .cpu-model-table td {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--color-border);
    vertical-align: middle;
  }

  .cpu-model-table td.numeric {
    text-align: right;
    font-variant-numeric: tabular-nums;
  }

  .cpu-model-table tbody tr:hover {
    background-color: rgba(59, 130, 246, 0.05);
  }

  .cpu-name {
    max-width: 300px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    font-weight: 500;
  }

  .rank-badge {
    display: inline-block;
    font-size: 0.625rem;
    font-weight: 600;
    text-transform: uppercase;
    padding: 0.125rem 0.375rem;
    margin-right: 0.5rem;
    background: linear-gradient(135deg, #ffd700, #ffb700);
    color: #1a1a1a;
    border-radius: 0.25rem;
  }

  .empty-state {
    text-align: center;
    color: var(--color-text-muted);
    padding: 2rem !important;
    font-style: italic;
  }

  /* Score Badge */
  .score-badge {
    display: inline-block;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.125rem 0.5rem;
    border-radius: 0.25rem;
    background: var(--color-bg);
    border: 1px solid var(--color-border);
  }

  .score-badge.score-high {
    background: rgba(34, 197, 94, 0.15);
    border-color: rgba(34, 197, 94, 0.4);
    color: #22c55e;
  }

  .score-badge.score-mid {
    background: rgba(234, 179, 8, 0.15);
    border-color: rgba(234, 179, 8, 0.4);
    color: #eab308;
  }

  .score-badge.score-low {
    background: rgba(239, 68, 68, 0.15);
    border-color: rgba(239, 68, 68, 0.4);
    color: #ef4444;
  }
</style>
