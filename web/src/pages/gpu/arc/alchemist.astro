---
/**
 * Arc Alchemist (A-Series) Page
 */
import Layout from '../../../layouts/Layout.astro';
import CodecMatrix from '../../../components/generation/CodecMatrix.astro';
import ArchitectureCard from '../../../components/generation/ArchitectureCard.astro';

const API_BASE = import.meta.env.PUBLIC_API_URL || 'https://quicksync-api.ktz.me';

let arcData: any = null;
let error: string | null = null;

try {
  const response = await fetch(`${API_BASE}/api/results/arc-models?architecture=Arc Alchemist`);
  if (response.ok) {
    arcData = await response.json();
    if (!arcData.success) {
      error = arcData.error || 'Failed to load Arc Alchemist data';
    }
  } else {
    error = `API error: ${response.status}`;
  }
} catch (e) {
  error = 'Failed to connect to API';
}

const archInfo = arcData?.architectures?.find((a: any) => a.architecture === 'Arc Alchemist');
const codecSupport = archInfo?.codec_support || {
  h264_encode: true,
  hevc_8bit_encode: true,
  hevc_10bit_encode: true,
  vp9_encode: true,
  av1_encode: true,
};

// Map architecture info to the format ArchitectureCard expects
const architectureData = archInfo ? {
  name: 'Arc Alchemist',
  codename: archInfo.codename || 'DG2',
  release_year: archInfo.release_year || 2022,
  igpu_name: archInfo.igpu_name || 'Intel Arc A-Series',
  igpu_codename: archInfo.igpu_codename || 'Xe-HPG',
  process_nm: archInfo.process_nm || 'TSMC N6',
  max_p_cores: null,
  max_e_cores: null,
  tdp_range: archInfo.tdp_range || '75-225W',
  die_layout: archInfo.die_layout || 'Discrete GPU (ACM-G10/G11)',
  gpu_eu_count: archInfo.gpu_eu_count || '128-512 EU',
} : null;

function cleanModelName(name: string): string {
  return name.replace(/^Intel\s*/i, '').replace(/^Arc\s*/i, '').trim();
}
---

<Layout title="Arc Alchemist (A-Series) - QuickSync Benchmarks">
  <div class="container">
    <div class="page-header">
      <h1>Arc Alchemist</h1>
      <p class="subtitle">Intel's first-generation discrete GPUs (A-Series)</p>
    </div>

    {error ? (
      <div class="error-state card">
        <p>{error}</p>
        <a href="/gpu/arc/all">&larr; Back to All Arc GPUs</a>
      </div>
    ) : arcData ? (
      <>
        {/* TL;DR */}
        <section class="tldr card">
          <h2>TL;DR</h2>
          <p>
            <strong>Arc Alchemist</strong> (codenamed DG2) is Intel's first-generation discrete GPU architecture,
            launched in 2022. The A-Series includes models from the entry-level A380 to the flagship A770.
            All models feature <strong>full AV1 hardware encoding</strong> and dual media engines for high throughput.
          </p>
        </section>

        {/* Navigation tabs */}
        <nav class="arch-nav">
          <a href="/gpu/arc/all" class="arch-tab">All Models</a>
          <a href="/gpu/arc/alchemist" class="arch-tab active">Alchemist (A-Series)</a>
          <a href="/gpu/arc/battlemage" class="arch-tab">Battlemage (B-Series)</a>
        </nav>

        {/* Architecture Details */}
        <div class="info-grid">
          {architectureData && (
            <section class="card">
              <h2>Architecture</h2>
              <ArchitectureCard architecture={architectureData} />
            </section>
          )}

          <section class="card">
            <h2>Codec Support</h2>
            <CodecMatrix codecSupport={codecSupport} />
          </section>
        </div>

        {/* Models */}
        <section class="models-section card">
          <h2>
            A-Series Models
            <span class="model-count">{arcData.models.length} {arcData.models.length === 1 ? 'model' : 'models'}</span>
          </h2>

          {arcData.models.length === 0 ? (
            <p class="no-data">No benchmark data available yet. <a href="/about">Learn how to contribute</a>.</p>
          ) : (
            <div class="models-grid">
              {arcData.models.map((model: any) => (
                <div class="model-card">
                  <h3 class="model-name">{cleanModelName(model.model_name)}</h3>
                  <div class="model-stats">
                    <span class="stat-item">
                      <span class="stat-label">Results</span>
                      <span class="stat-value">{model.total_results}</span>
                    </span>
                  </div>

                  {model.by_test.length > 0 && (
                    <table class="model-results">
                      <thead>
                        <tr>
                          <th>Test</th>
                          <th class="numeric">FPS</th>
                          <th class="numeric">FPS/W</th>
                        </tr>
                      </thead>
                      <tbody>
                        {model.by_test.map((test: any) => (
                          <tr>
                            <td>
                              <span class:list={['test-badge', test.test_name.includes('hevc') ? 'hevc' : test.test_name.includes('av1') ? 'av1' : 'h264']}>
                                {test.test_name}
                              </span>
                            </td>
                            <td class="numeric">{test.avg_fps?.toFixed(1) || '—'}</td>
                            <td class="numeric">{test.fps_per_watt?.toFixed(2) || '—'}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  )}
                </div>
              ))}
            </div>
          )}
        </section>

        {/* Known Models Info */}
        <section class="card">
          <h2>Alchemist Model Lineup</h2>
          <table class="specs-table">
            <thead>
              <tr>
                <th>Model</th>
                <th>GPU Die</th>
                <th>Xe-Cores</th>
                <th>VRAM</th>
                <th>TDP</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Arc A770</td>
                <td>ACM-G10</td>
                <td>32</td>
                <td>16GB GDDR6</td>
                <td>225W</td>
              </tr>
              <tr>
                <td>Arc A750</td>
                <td>ACM-G10</td>
                <td>28</td>
                <td>8GB GDDR6</td>
                <td>225W</td>
              </tr>
              <tr>
                <td>Arc A580</td>
                <td>ACM-G10</td>
                <td>24</td>
                <td>8GB GDDR6</td>
                <td>185W</td>
              </tr>
              <tr>
                <td>Arc A380</td>
                <td>ACM-G11</td>
                <td>8</td>
                <td>6GB GDDR6</td>
                <td>75W</td>
              </tr>
              <tr>
                <td>Arc A310</td>
                <td>ACM-G11</td>
                <td>6</td>
                <td>4GB GDDR6</td>
                <td>75W</td>
              </tr>
            </tbody>
          </table>
        </section>

        {/* Pricing */}
        <section class="pricing-section card">
          <h2>Find Arc Alchemist GPUs</h2>
          <div class="pricing-links">
            <a href="https://www.ebay.com/sch/i.html?_nkw=intel+arc+a770" target="_blank" rel="noopener" class="pricing-link">A770 on eBay</a>
            <a href="https://www.ebay.com/sch/i.html?_nkw=intel+arc+a750" target="_blank" rel="noopener" class="pricing-link">A750 on eBay</a>
            <a href="https://www.ebay.com/sch/i.html?_nkw=intel+arc+a380" target="_blank" rel="noopener" class="pricing-link">A380 on eBay</a>
            <a href="https://www.amazon.com/s?k=intel+arc+a770" target="_blank" rel="noopener" class="pricing-link">Amazon</a>
          </div>
        </section>
      </>
    ) : (
      <div class="loading-state">Loading...</div>
    )}
  </div>
</Layout>

<style>
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .page-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .page-header h1 {
    font-size: 2rem;
    font-weight: 700;
    margin: 0;
  }

  .subtitle {
    color: var(--color-text-muted);
    margin-top: 0.5rem;
  }

  section {
    margin-bottom: 1.5rem;
  }

  section h2 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .model-count {
    font-size: 0.75rem;
    font-weight: 400;
    color: var(--color-text-muted);
  }

  .tldr p {
    line-height: 1.7;
  }

  /* Info Grid */
  .info-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
  }

  @media (max-width: 768px) {
    .info-grid {
      grid-template-columns: 1fr;
    }
  }

  /* Navigation */
  .arch-nav {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }

  .arch-tab {
    padding: 0.5rem 1rem;
    background: var(--color-bg-card);
    border: 1px solid var(--color-border);
    border-radius: 0.375rem;
    font-size: 0.875rem;
    transition: all 0.2s;
  }

  .arch-tab:hover {
    border-color: var(--color-accent);
    text-decoration: none;
  }

  .arch-tab.active {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: white;
  }

  /* Models Grid */
  .models-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
  }

  .model-card {
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: 0.5rem;
    padding: 1rem;
  }

  .model-name {
    font-size: 1.125rem;
    font-weight: 600;
    margin: 0 0 0.75rem;
  }

  .model-stats {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .stat-item {
    display: flex;
    flex-direction: column;
  }

  .stat-label {
    font-size: 0.625rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
  }

  .stat-value {
    font-size: 1rem;
    font-weight: 600;
  }

  .model-results {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.8125rem;
  }

  .model-results th,
  .model-results td {
    padding: 0.5rem;
    text-align: left;
    border-bottom: 1px solid var(--color-border);
  }

  .model-results th.numeric,
  .model-results td.numeric {
    text-align: right;
  }

  .model-results th {
    font-weight: 500;
    font-size: 0.6875rem;
    text-transform: uppercase;
    color: var(--color-text-muted);
  }

  .test-badge {
    display: inline-block;
    padding: 0.0625rem 0.375rem;
    border-radius: 0.125rem;
    font-size: 0.6875rem;
    font-weight: 500;
    background-color: var(--color-bg-secondary);
  }

  .test-badge.h264 { color: #22c55e; }
  .test-badge.hevc { color: #3b82f6; }
  .test-badge.av1 { color: #a855f7; }

  /* Specs Table */
  .specs-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.875rem;
  }

  .specs-table th,
  .specs-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid var(--color-border);
  }

  .specs-table th {
    font-weight: 500;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
  }

  /* Pricing */
  .pricing-links {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .pricing-link {
    padding: 0.5rem 1rem;
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: 0.375rem;
    font-size: 0.875rem;
    transition: all 0.2s;
  }

  .pricing-link:hover {
    border-color: var(--color-accent);
    text-decoration: none;
  }

  .no-data {
    color: var(--color-text-muted);
    text-align: center;
    padding: 2rem;
  }

  .error-state, .loading-state {
    text-align: center;
    padding: 2rem;
  }
</style>
